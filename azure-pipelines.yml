trigger:
- main

pool:
  vmImage: 'ubuntu-latest'

variables:
  JAVA_HOME: /usr/lib/jvm/jdk-17

steps:
- script: |
    sudo apt-get update
    sudo apt-get install -y wget tar
    wget https://download.java.net/java/GA/jdk17/35/GPL/openjdk-17_linux-x64_bin.tar.gz
    tar -xvf openjdk-17_linux-x64_bin.tar.gz
    sudo mv jdk-17 /usr/lib/jvm/
    sudo update-alternatives --install /usr/bin/java java /usr/lib/jvm/jdk-17/bin/java 1
    sudo update-alternatives --install /usr/bin/javac javac /usr/lib/jvm/jdk-17/bin/javac 1
    sudo update-alternatives --set java /usr/lib/jvm/jdk-17/bin/java
    sudo update-alternatives --set javac /usr/lib/jvm/jdk-17/bin/javac
    echo "JAVA_HOME is set to $JAVA_HOME"
  displayName: 'Install and Verify Java 17'

- script: |
    echo "Java setup complete"
  displayName: 'Confirmation Step'

- task: NodeTool@0
  inputs:
    versionSpec: '20.15.1'
  displayName: 'Install Node.js'
  env:
    JAVA_HOME: $(JAVA_HOME)

- script: |
    export PATH=$JAVA_HOME/bin:$PATH
    java -version
    npm install
    npm run android
  displayName: 'npm install and build'
  env:
    JAVA_HOME: $(JAVA_HOME)
